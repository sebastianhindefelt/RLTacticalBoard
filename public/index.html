<!DOCTYPE html>
<html>
    <head>
        <style>
            canvas {
                background-image: url("/img/DFHStadium.png");
                background-size: 100% 100%;
            }
        </style>
        <title>Rocket League Tactical Board</title>
    </head>
    <body>
        <canvas id="field" ondrop="drop(event)" width="400" height="600"></canvas>
        <img id="car" src="/img/car.png" draggable="true"
            ondragstart="drag(event)" width="86" height="169">
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect();
            var username = 'unnamed';
            var c = document.getElementById("field");
            c.addEventListener('mousedown', handleMouse, false);
            var img = new Image;
            img.src = "/img/car.png";
            
            // network operations
            socket.on('update', function(data) {
                      var c = document.getElementById("field");
                      var ctx = c.getContext("2d");
                      
                      ctx.clearRect(0,0,c.width,c.height);
                      ctx.drawImage(img,data.xPos,data.yPos);
            });
            socket.on('username', function(data) {
                username = data.username;
            });
            
            // handlers
            function handleMouse(event) {
                var x = event.pageX;
                var y = event.pageY;
                socket.emit('clicked', {username: username, xPos: x, yPos: y});
            }
        
            function drop(event) {
                event.preventDefault();
                var data = event.dataTransfer.getData("type");
                socket.emit('added', {type: data});
            }
        
            function drag(event) {
                // TODO: probably better to let it drag the image and then catch the drag over the canvas and add the car there
                // an alternative would be to add some kind of other image along with the drag
                event.preventDefault();
                event.dataTransfer.setData("type", event.target.id);
            }
        
            function allowDrop(ev) {
                event.preventDefault();
            }
            
            </script>
    </body>
</html>